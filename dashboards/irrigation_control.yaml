title: "Irrigation Control"
views:
  - title: "Control"
    path: control
    icon: mdi:sprinkler-variant

    cards:
      # ────────── Row 1 ────────────────────────────────────────────
      - type: vertical-stack
        title: "Row 1"
        cards:
          # System overview (compact) – Pumpe kann dynamisch geändert werden
          - type: custom:config-template-card
            variables:
              pump: states['input_text.irrigation_relay_entity'].state
            entities:
              # Card aktualisiert sich, wenn sich die Auswahl ändert
              - input_text.irrigation_relay_entity
              - sensor.irrigation_relais1_power
              - sensor.irrigation_relais1_energy
            card:
              type: glance
              title: "System"
              show_state: true
              entities:
                - entity: "${pump}"
                  name: "Pump"
                - entity: sensor.irrigation_relais1_power
                  name: "Actual Power"
                - entity: sensor.irrigation_relais1_energy
                  name: "Total Consumption"

          # ► Both cards beside each other
          - type: horizontal-stack
            cards:
              # Manual irrigation trigger
              - type: button
                name: "Manual Irrigation"
                icon: mdi:water-pump
                tap_action:
                  action: call-service
                  service: script.irrigation_run

              # Radiation gauge (dynamic threshold)
              - type: custom:config-template-card
                variables:
                  threshold: states['sensor.radiation_threshold_current'].state
                entities:
                  - sensor.radiation_threshold_current
                  - sensor.radiation_since_irrigation
                card:
                  type: gauge
                  entity: sensor.radiation_since_irrigation
                  min: 0
                  max: ${Number(threshold) + 10}
                  needle: true
                  segments:
                    - from: 0
                      color: "#9e9e9e"
                    - from: ${Number(threshold)}
                      color: "#00bcd4"
                      label: Irrigation

      # ────────── Weatherstation ──────────────────────────────────
      - type: vertical-stack
        title: "Weatherstation"
        cards:
          # Global radiation graph
          - type: sensor
            entity: sensor.global_radiation_energy
            name: "Global Radiation Energy"
            graph: line
            unit: "Wh/m²"
          # Manual radiation input
          - type: entities
            title: "Weatherstation – Manual Radiation Input"
            entities:
              - input_number.global_radiation
              - input_number.radiation_speed
